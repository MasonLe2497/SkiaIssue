import {
  Canvas,
  Easing,
  Group,
  Path,
  SkPath,
  Skia,
  runTiming,
  useComputedValue,
  useValue,
} from '@shopify/react-native-skia';
import React from 'react';
import {Button, Dimensions, StyleSheet} from 'react-native';
import {
  useDerivedValue,
  useSharedValue,
  withTiming,
} from 'react-native-reanimated';
import {SafeAreaView} from 'react-native-safe-area-context';

const dayPathSVG =
  'M10 35C10 35 10 35 10 35C10 35 10 35 10 35C10 35 10 35 10 35C10 35 10 35 10 35C10 35 10 35 10 35C10 35 10 35 10 35C10 35 10 35 10 35C10 35 10 35 10 35C10 35 10 35 10 35C56.75 35 56.75 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C103.5 314.145 103.5 314.145 103.5 314.145C150.25 314.145 150.25 146.222 197 146.222C197 146.222 197 146.222 197 146.222C197 146.222 197 146.222 197 146.222C197 146.222 197 146.222 197 146.222C197 146.222 197 146.222 197 146.222C197 146.222 197 146.222 197 146.222C197 146.222 197 146.222 197 146.222C197 146.222 197 146.222 197 146.222C197 146.222 197 146.222 197 146.222C197 146.222 197 146.222 197 146.222C243.75 146.222 243.75 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C290.5 240.895 290.5 240.895 290.5 240.895C337.25 240.895 337.25 158.171 384 158.171C384 158.171 384 158.171 384 158.171C384 158.171 384 158.171 384 158.171C384 158.171 384 158.171 384 158.171C384 158.171 384 158.171 384 158.171C384 158.171 384 158.171 384 158.171C384 158.171 384 158.171 384 158.171C384 158.171 384 158.171 384 158.171C384 158.171 384 158.171 384 158.171C384 158.171 384 158.171 384 158.171';

const yearPathSVG =
  'M10 311.484C29.898 311.484 29.898 337.583 49.796 337.583C69.694 337.583 69.694 321.883 89.592 321.883C109.49 321.883 109.49 330.734 129.388 330.734C149.286 330.734 149.286 323 169.184 323C189.082 323 189.082 323.627 208.98 323.627C228.878 323.627 228.878 332.572 248.776 332.572C268.673 332.572 268.673 301.395 288.571 301.395C308.469 301.395 308.469 256.457 328.367 256.457C348.265 256.457 348.265 327.609 368.163 327.609C388.061 327.609 388.061 316.973 407.959 316.973C427.857 316.973 427.857 311.697 447.755 311.697C467.653 311.697 467.653 308.191 487.551 308.191C507.449 308.191 507.449 142.577 527.347 142.577C547.245 142.577 547.245 318.042 567.143 318.042C587.041 318.042 587.041 324.861 606.939 324.861C626.837 324.861 626.837 313.233 646.735 313.233C666.633 313.233 666.633 218.222 686.531 218.222C706.429 218.222 706.429 331.724 726.327 331.724C746.224 331.724 746.224 250.464 766.122 250.464C786.02 250.464 786.02 308.706 805.918 308.706C825.816 308.706 825.816 222.185 845.714 222.185C865.612 222.185 865.612 296.804 885.51 296.804C905.408 296.804 905.408 141.63 925.306 141.63C945.204 141.63 945.204 267.005 965.102 267.005C985 267.005 985 254.557 1004.9 254.557C1024.8 254.557 1024.8 317.774 1044.69 317.774C1064.59 317.774 1064.59 306.304 1084.49 306.304C1104.39 306.304 1104.39 138.466 1124.29 138.466C1144.18 138.466 1144.18 334.167 1164.08 334.167C1183.98 334.167 1183.98 304.58 1203.88 304.58C1223.78 304.58 1223.78 242.013 1243.67 242.013C1263.57 242.013 1263.57 307.307 1283.47 307.307C1303.37 307.307 1303.37 312.729 1323.27 312.729C1343.16 312.729 1343.16 192.874 1363.06 192.874C1382.96 192.874 1382.96 288.834 1402.86 288.834C1422.76 288.834 1422.76 246.322 1442.65 246.322C1462.55 246.322 1462.55 292.065 1482.45 292.065C1502.35 292.065 1502.35 334.75 1522.24 334.75C1542.14 334.75 1542.14 248.358 1562.04 248.358C1581.94 248.358 1581.94 277.929 1601.84 277.929C1621.73 277.929 1621.73 220.564 1641.63 220.564C1661.53 220.564 1661.53 336.894 1681.43 336.894C1701.33 336.894 1701.33 153.991 1721.22 153.991C1741.12 153.991 1741.12 339.581 1761.02 339.581C1780.92 339.581 1780.92 306.51 1800.82 306.51C1820.71 306.51 1820.71 249.548 1840.61 249.548C1860.51 249.548 1860.51 338.028 1880.41 338.028C1900.31 338.028 1900.31 173.977 1920.2 173.977C1940.1 173.977 1940.1 35 1960 35';

const dayPathSK = Skia.Path.MakeFromSVGString(dayPathSVG)!;
const yearPathSK = Skia.Path.MakeFromSVGString(yearPathSVG)!;

const GRAPH_WIDTH = Dimensions.get('window').width - 20;

const LAST_X_OF_YEAR = yearPathSK.getLastPt().x - GRAPH_WIDTH;

export const Issue1627 = () => {
  // state
  const paths = useValue<{from: SkPath; to: SkPath}>({
    from: dayPathSK,
    to: yearPathSK,
  });
  const progressPath = useValue(0);
  const translateX = useSharedValue(0);

  const translateXSkia = useValue(0);
  const path = useComputedValue(() => {
    const {from, to} = paths.current;
    if (!from || !to) {
      return Skia.Path.Make();
    }
    return to.interpolate(from, progressPath.current)!;
  }, [progressPath]);

  const transform = useComputedValue(
    () => [{translateX: translateXSkia.current}],
    [translateXSkia],
  );

  const transform1 = useDerivedValue(
    () => [{translateX: translateX.value}, {translateY: 300}],
    [translateX],
  );

  // func
  const handleChangeYear = () => {
    // path
    paths.current = {
      to: paths.current.to,
      from: dayPathSK,
    };
    progressPath.current = 0;

    runTiming(progressPath, 1, {
      duration: 3000,
      easing: Easing.linear,
    });

    runTiming(translateXSkia, -LAST_X_OF_YEAR, {
      duration: 3000,
      easing: Easing.linear,
    });
    translateX.value = withTiming(-LAST_X_OF_YEAR, {
      duration: 3000,
    });
  };

  // render
  return (
    <SafeAreaView style={styles.canvas}>
      <Canvas style={styles.canvas}>
        <Group transform={transform}>
          <Path path={path} strokeWidth={1} style={'stroke'} color={'violet'} />
        </Group>
        <Group transform={transform1}>
          <Path path={path} strokeWidth={1} style={'stroke'} color={'red'} />
        </Group>
      </Canvas>
      <Button title="Change to Year" onPress={handleChangeYear} />
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  canvas: {
    flex: 1,
  },
});
